{{define "poll-results-partial"}}
<div
  id="poll-container"
  class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"
  hx-get="/poll/{{ .WorkflowID }}/results"
  hx-trigger="every 2s"
  hx-swap="outerHTML"
>
  {{range .Options}} {{ $option := . }} {{ $imageURL := index $.ImageURLs
  $option }} {{ $votes := index $.State.Options $option }}

  <div class="text-center">
    <div
      class="relative rounded-lg overflow-hidden border-2 border-transparent hover:border-blue-500 transition-all duration-300 cursor-pointer"
      hx-post="/poll/{{ $.WorkflowID }}/vote"
      hx-target="#poll-container"
      hx-swap="innerHTML"
      hx-vals='{"option": "{{ $option }}"}'
    >
      {{if $imageURL}}
      <img
        src="{{ $imageURL }}"
        alt="{{ $option }}"
        class="w-full h-auto object-cover"
        onerror="this.parentElement.innerHTML='<div class=\'w-full h-48 bg-gray-800 flex items-center justify-center\'><span class=\'text-gray-500\'>Image failed to load</span></div>'"
      />
      {{else}}
      <div class="w-full h-48 bg-gray-800 flex flex-col items-center justify-center">
        <svg class="animate-spin h-10 w-10 text-blue-500 mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span class="text-gray-400 text-sm">Generating image...</span>
      </div>
      {{end}}
    </div>
    <h3 class="text-xl font-semibold mt-4">{{ $option }}</h3>
    <p class="text-2xl font-bold cyber-text-glow">{{ or $votes 0 }}</p>
  </div>
  {{else}}
  <p class="text-center col-span-full">No options available for this poll.</p>
  {{end}}
</div>
{{end}}
